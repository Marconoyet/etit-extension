const moves = [
  {
    "Start Date": "23/12/2023 00:00:00",
    "End Date": "23/12/2023 00:08:25",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,الجيزة,قسم ثان 6 اكتوبر,خارج زمام الشياخات,18,مسجد",
    "To Address": "مصر,الجيزة,قسم ثان 6 اكتوبر,خارج زمام الشياخات,18,مسجد",
    "Distance Travelled": "0.00",
    "Max Speed": "0",
    "Event Type": "Parking",
    Geofence: "",
    "": "30.887596",
  },
  {
    "Start Date": "23/12/2023 00:08:25",
    "End Date": "23/12/2023 01:47:45",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,الجيزة,قسم ثان 6 اكتوبر,خارج زمام الشياخات,18,مسجد",
    "To Address": "مصر,الجيزة,قسم ثان 6 اكتوبر,خارج زمام الشياخات,18,مسجد",
    "Distance Travelled": "0.00",
    "Max Speed": "0",
    "Event Type": "Parking",
    Geofence: "",
    "": "30.887596",
  },
  {
    "Start Date": "23/12/2023 01:47:45",
    "End Date": "23/12/2023 01:53:57",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,الجيزة,قسم ثان 6 اكتوبر,خارج زمام الشياخات,18,مسجد",
    "To Address": "مصر,الجيزة,قسم ثان 6 اكتوبر,خارج زمام الشياخات,18,مسجد",
    "Distance Travelled": "0.00",
    "Max Speed": "0",
    "Event Type": "Idle",
    Geofence: "",
    "": "30.887582",
  },
  {
    "Start Date": "23/12/2023 01:53:57",
    "End Date": "23/12/2023 03:12:01",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,الجيزة,قسم ثان 6 اكتوبر,خارج زمام الشياخات,18,مسجد",
    "To Address":
      "مصر,الجيزة,قسم ثان 6 اكتوبر,خارج زمام الشياخات,18,مصنع جهينة للمنتجات الغذائية",
    "Distance Travelled": "0.00",
    "Max Speed": "0",
    "Event Type": "Parking",
    Geofence: "",
    "": "30.887426",
  },
  {
    "Start Date": "23/12/2023 03:12:01",
    "End Date": "23/12/2023 03:17:56",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address":
      "مصر,الجيزة,قسم ثان 6 اكتوبر,خارج زمام الشياخات,18,مصنع جهينة للمنتجات الغذائية",
    "To Address":
      "مصر,الجيزة,قسم ثان 6 اكتوبر,خارج زمام الشياخات,,الشركة العربية للمنتجات الغذائية",
    "Distance Travelled": "0.00",
    "Max Speed": "0",
    "Event Type": "Idle",
    Geofence: "",
    "": "30.886129",
  },
  {
    "Start Date": "23/12/2023 03:17:56",
    "End Date": "23/12/2023 04:32:42",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address":
      "مصر,الجيزة,قسم ثان 6 اكتوبر,خارج زمام الشياخات,,الشركة العربية للمنتجات الغذائية",
    "To Address":
      "طريق مصر اسكندرية الصحراوى, مدينة السادات, محافظة المنوفية, مصر",
    "Distance Travelled": "75.35",
    "Max Speed": "83",
    "Event Type": "Moving",
    Geofence: "",
    "": "30.544099",
  },
  {
    "Start Date": "23/12/2023 04:32:42",
    "End Date": "23/12/2023 04:39:41",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address":
      "طريق مصر اسكندرية الصحراوى, مدينة السادات, محافظة المنوفية, مصر",
    "To Address": "11 Alex Desert Road;Desert Road, مدينة السادات, مصر (Egypt)",
    "Distance Travelled": "0.00",
    "Max Speed": "0",
    "Event Type": "Idle",
    Geofence: "",
    "": "30.539598",
  },
  {
    "Start Date": "23/12/2023 04:39:41",
    "End Date": "23/12/2023 04:42:13",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address":
      "11 Alex Desert Road;Desert Road, مدينة السادات, مصر (Egypt)",
    "To Address": "طريق شبين الكوم - السادات، Menofia Governorate, Egypt",
    "Distance Travelled": "1.78",
    "Max Speed": "58",
    "Event Type": "Moving",
    Geofence: "",
    "": "30.524905",
  },
  {
    "Start Date": "23/12/2023 04:42:13",
    "End Date": "23/12/2023 04:44:40",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "طريق شبين الكوم - السادات، Menofia Governorate, Egypt",
    "To Address": "مصر,المنوفية,مركز السادات,,كفر داوود - مدينة السادات,",
    "Distance Travelled": "0.00",
    "Max Speed": "0",
    "Event Type": "Idle",
    Geofence: "",
    "": "30.527175",
  },
  {
    "Start Date": "23/12/2023 04:44:40",
    "End Date": "23/12/2023 05:06:06",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,,كفر داوود - مدينة السادات,",
    "To Address": "مصر,المنوفية,مركز السادات,,,",
    "Distance Travelled": "9.43",
    "Max Speed": "58",
    "Event Type": "Moving",
    Geofence: "",
    "": "30.578565",
  },
  {
    "Start Date": "23/12/2023 05:06:06",
    "End Date": "23/12/2023 09:47:11",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,,,",
    "To Address": "مصر,المنوفية,مركز السادات,,,",
    "Distance Travelled": "0.00",
    "Max Speed": "0",
    "Event Type": "Parking",
    Geofence: "",
    "": "30.578565",
  },
  {
    "Start Date": "23/12/2023 09:47:11",
    "End Date": "23/12/2023 09:51:31",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,,,",
    "To Address": "مصر,المنوفية,مركز السادات,,,",
    "Distance Travelled": "0.00",
    "Max Speed": "0",
    "Event Type": "Idle",
    Geofence: "",
    "": "30.578986",
  },
  {
    "Start Date": "23/12/2023 09:51:31",
    "End Date": "23/12/2023 10:01:07",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,,,",
    "To Address": "مصر,المنوفية,مركز السادات,,,",
    "Distance Travelled": "1.82",
    "Max Speed": "23",
    "Event Type": "Moving",
    Geofence: "",
    "": "30.566776",
  },
  {
    "Start Date": "23/12/2023 10:01:07",
    "End Date": "23/12/2023 10:03:22",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,,,",
    "To Address": "مصر,المنوفية,مركز السادات,,,",
    "Distance Travelled": "0.00",
    "Max Speed": "0",
    "Event Type": "Idle",
    Geofence: "",
    "": "30.56674",
  },
  {
    "Start Date": "23/12/2023 10:03:22",
    "End Date": "23/12/2023 19:41:16",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,,,",
    "To Address": "مصر,المنوفية,مركز السادات,,,",
    "Distance Travelled": "0.00",
    "Max Speed": "0",
    "Event Type": "Parking",
    Geofence: "",
    "": "30.56674",
  },
  {
    "Start Date": "23/12/2023 19:41:16",
    "End Date": "23/12/2023 19:46:58",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,,,",
    "To Address": "مصر,المنوفية,مركز السادات,,,",
    "Distance Travelled": "0.00",
    "Max Speed": "0",
    "Event Type": "Idle",
    Geofence: "",
    "": "30.56637",
  },
  {
    "Start Date": "23/12/2023 19:46:58",
    "End Date": "23/12/2023 19:56:09",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,,,",
    "To Address": "مصر,المنوفية,مركز السادات,,,",
    "Distance Travelled": "1.87",
    "Max Speed": "25",
    "Event Type": "Moving",
    Geofence: "",
    "": "30.578734",
  },
  {
    "Start Date": "23/12/2023 19:56:09",
    "End Date": "23/12/2023 20:01:00",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,,,",
    "To Address": "مصر,المنوفية,مركز السادات,,,",
    "Distance Travelled": "0.00",
    "Max Speed": "0",
    "Event Type": "Idle",
    Geofence: "",
    "": "30.57799",
  },
  {
    "Start Date": "23/12/2023 20:01:00",
    "End Date": "23/12/2023 20:11:06",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,,,",
    "To Address": "مصر,المنوفية,مركز السادات,,,",
    "Distance Travelled": "2.04",
    "Max Speed": "29",
    "Event Type": "Moving",
    Geofence: "",
    "": "30.564936",
  },
  {
    "Start Date": "23/12/2023 20:11:06",
    "End Date": "23/12/2023 20:15:32",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,,,",
    "To Address": "مصر,المنوفية,مركز السادات,,,",
    "Distance Travelled": "0.00",
    "Max Speed": "0",
    "Event Type": "Idle",
    Geofence: "",
    "": "30.564936",
  },
  {
    "Start Date": "23/12/2023 20:15:32",
    "End Date": "23/12/2023 20:24:56",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,,,",
    "To Address": "مصر,المنوفية,مركز السادات,,,",
    "Distance Travelled": "0.00",
    "Max Speed": "0",
    "Event Type": "Parking",
    Geofence: "",
    "": "30.564936",
  },
  {
    "Start Date": "23/12/2023 20:24:56",
    "End Date": "23/12/2023 20:41:09",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,,,",
    "To Address": "مصر,المنوفية,مركز السادات,,,",
    "Distance Travelled": "0.00",
    "Max Speed": "0",
    "Event Type": "Idle",
    Geofence: "",
    "": "30.564929",
  },
  {
    "Start Date": "23/12/2023 20:41:09",
    "End Date": "23/12/2023 21:07:46",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,,,",
    "To Address": "Desert Road, مدينة السادات, مصر (Egypt)",
    "Distance Travelled": "15.89",
    "Max Speed": "64",
    "Event Type": "Moving",
    Geofence: "",
    "": "30.647932",
  },
  {
    "Start Date": "23/12/2023 21:07:46",
    "End Date": "23/12/2023 21:12:45",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "Desert Road, مدينة السادات, مصر (Egypt)",
    "To Address":
      "مصر,المنوفية,مركز السادات,,طريق القاهرة الاسكندرية الصحراوى,",
    "Distance Travelled": "0.00",
    "Max Speed": "0",
    "Event Type": "Idle",
    Geofence: "",
    "": "30.651775",
  },
  {
    "Start Date": "23/12/2023 21:12:45",
    "End Date": "23/12/2023 22:17:33",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address":
      "مصر,المنوفية,مركز السادات,,طريق القاهرة الاسكندرية الصحراوى,",
    "To Address":
      "مصر,الجيزة,قسم ثان 6 اكتوبر,خارج زمام الشياخات,22,مصنع المحاصيل الزراعية",
    "Distance Travelled": "59.36",
    "Max Speed": "76",
    "Event Type": "Moving",
    Geofence: "",
    "": "30.900362",
  },
  {
    "Start Date": "23/12/2023 22:17:33",
    "End Date": "23/12/2023 22:20:33",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address":
      "مصر,الجيزة,قسم ثان 6 اكتوبر,خارج زمام الشياخات,22,مصنع المحاصيل الزراعية",
    "To Address":
      "Factori Street No. 22, الحى السادس, مدينة السادس من أكتوبر, محافظة الجيزة‎, 12566, مصر (Egypt)",
    "Distance Travelled": "0.00",
    "Max Speed": "0",
    "Event Type": "Idle",
    Geofence: "",
    "": "30.89931",
  },
  {
    "Start Date": "23/12/2023 22:20:33",
    "End Date": "23/12/2023 22:29:31",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address":
      "Factori Street No. 22, الحى السادس, مدينة السادس من أكتوبر, محافظة الجيزة‎, 12566, مصر (Egypt)",
    "To Address": "مصر,الجيزة,قسم ثان 6 اكتوبر,خارج زمام الشياخات,18,مسجد",
    "Distance Travelled": "2.75",
    "Max Speed": "34",
    "Event Type": "Moving",
    Geofence: "",
    "": "30.887475",
  },
  {
    "Start Date": "23/12/2023 22:29:54",
    "End Date": "23/12/2023 23:59:35",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,الجيزة,قسم ثان 6 اكتوبر,خارج زمام الشياخات,18,مسجد",
    "To Address": "مصر,الجيزة,قسم ثان 6 اكتوبر,خارج زمام الشياخات,18,مسجد",
    "Distance Travelled": "0.00",
    "Max Speed": "0",
    "Event Type": "Parking",
    Geofence: "",
    "": "30.887475",
  },
  {
    "Start Date": "23/12/2023 23:59:35",
    "End Date": "23/12/2023 23:59:59",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,الجيزة,قسم ثان 6 اكتوبر,خارج زمام الشياخات,18,مسجد",
    "To Address": "مصر,الجيزة,قسم ثان 6 اكتوبر,خارج زمام الشياخات,18,مسجد",
    "Distance Travelled": "0.00",
    "Max Speed": "0",
    "Event Type": "Parking",
    Geofence: "",
    "": "30.887475",
  },
];
let fromAddress = "",
  toAddress = "",
  startDate = "",
  EndDate = "",
  counter = 0,
  distance = 0,
  tempArr = [],
  moved = false,
  backCheck = false;

const indexOfFirstObject = moves.findIndex(
  (obj) => obj["Distance Travelled"] > 15
);

const reversemoves = [...moves].reverse();
const indexOfLastObject =
  moves.length -
  reversemoves.findIndex((obj) => obj["Distance Travelled"] > 15) -
  1;

// console.log(indexOfFirstObject, indexOfLastObject);
if (indexOfFirstObject !== -1 && indexOfLastObject !== -1) {
  // Select objects above the first
  const objectsAboveFirst = moves
    .slice(0, indexOfFirstObject)
    .map((obj) => {
      if (!tempArr.includes(obj["From Address"])) {
        tempArr.push(obj["From Address"]);
        return obj["From Address"];
      } else if (!tempArr.includes(obj["To Address"])) {
        tempArr.push(obj["To Address"]);
        return obj["To Address"];
      }
    })
    .filter(Boolean);

  tempArr.splice(0, tempArr.length);

  // Select objects below the last
  const objectsBelowLast = moves
    .slice(indexOfLastObject + 1)
    .map((obj) => {
      if (!tempArr.includes(obj["From Address"])) {
        tempArr.push(obj["From Address"]);
        return obj["From Address"];
      } else if (!tempArr.includes(obj["To Address"])) {
        tempArr.push(obj["To Address"]);
        return obj["To Address"];
      }
    })
    .filter(Boolean);

  const commonElements = objectsAboveFirst.filter((element) =>
    objectsBelowLast.includes(element)
  );
  if (commonElements.length !== 0) backCheck = true;
  console.log(commonElements); // Output: [3, 4, 5]
  console.log("Objects above the first one:", objectsAboveFirst);
  console.log("Objects below the last one:", objectsBelowLast);
} else {
  console.log("Error in select indexing");
}

if (!backCheck)
  moves.map((move, index) => {
    // know if didn't move
    distance += +move["Distance Travelled"];
    // get first move (fromAddress & startDate)
    if (
      move["From Address"] !== move["To Address"] &&
      counter === 0 &&
      +move["Distance Travelled"] > 10
    ) {
      moved = true;
      fromAddress = move["From Address"];
      startDate = move["Start Date"].split(" ")[1];
      counter++;
    }
    // get last move (toAddress & endDate)
    if (
      move["From Address"] !== move["To Address"] &&
      +move["Distance Travelled"] > 5
    ) {
      toAddress = move["To Address"];
      EndDate = move["End Date"].split(" ")[1];
    }

    // fix bug of select last move
    // last position is changed in from address without matched with to address in above column
    if (
      index < moves.length - 1 &&
      move["To Address"] !== moves[index + 1]["From Address"]
    ) {
      toAddress = moves[index + 1]["To Address"];
      EndDate = moves[index + 1]["End Date"].split(" ")[1];
    }
  });
else {
}
if ((distance <= 10 || !moved) && !backCheck) {
  fromAddress = "";
  toAddress = "";
  startDate = "";
  EndDate = "";
  console.log("لا يكــــــــــــــــــــــــن");
} else if (fromAddress !== "") {
  console.log(fromAddress);
  console.log(toAddress);
  console.log(startDate);
  console.log(EndDate);
}
