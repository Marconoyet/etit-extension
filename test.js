const moves = [
  {
    "Start Date": "26/12/2023 00:00:00",
    "End Date": "26/12/2023 00:00:02",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,,,",
    "To Address": "مصر,المنوفية,مركز السادات,,,",
    "Distance Travelled": "0.00",
    "Max Speed": "0",
    "Event Type": "Parking",
    Geofence: "",
    "": "30.55959",
  },
  {
    "Start Date": "26/12/2023 00:00:02",
    "End Date": "26/12/2023 00:04:01",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,,,",
    "To Address": "مصر,المنوفية,مركز السادات,,,",
    "Distance Travelled": "0.59",
    "Max Speed": "20",
    "Event Type": "Moving",
    Geofence: "",
    "": "30.561338",
  },
  {
    "Start Date": "26/12/2023 00:04:01",
    "End Date": "26/12/2023 00:05:04",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,,,",
    "To Address": "مصر,المنوفية,مركز السادات,,,",
    "Distance Travelled": "0.00",
    "Max Speed": "0",
    "Event Type": "Idle",
    Geofence: "",
    "": "30.561338",
  },
  {
    "Start Date": "26/12/2023 00:05:04",
    "End Date": "26/12/2023 00:54:02",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,,,",
    "To Address": "مصر,المنوفية,مركز السادات,,,",
    "Distance Travelled": "0.00",
    "Max Speed": "0",
    "Event Type": "Parking",
    Geofence: "",
    "": "30.561338",
  },
  {
    "Start Date": "26/12/2023 00:54:02",
    "End Date": "26/12/2023 00:59:01",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,,,",
    "To Address": "مصر,المنوفية,مركز السادات,,,",
    "Distance Travelled": "0.00",
    "Max Speed": "0",
    "Event Type": "Idle",
    Geofence: "",
    "": "30.562616",
  },
  {
    "Start Date": "26/12/2023 00:59:01",
    "End Date": "26/12/2023 01:22:05",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,,,",
    "To Address":
      "مصر,المنوفية,مركز السادات,مدينة السادات,طريق مبارك,مصنع اما السادات",
    "Distance Travelled": "11.72",
    "Max Speed": "40",
    "Event Type": "Moving",
    Geofence: "",
    "": "30.556198",
  },
  {
    "Start Date": "26/12/2023 01:22:05",
    "End Date": "26/12/2023 01:25:19",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address":
      "مصر,المنوفية,مركز السادات,مدينة السادات,طريق مبارك,مصنع اما السادات",
    "To Address":
      "مصر,المنوفية,مركز السادات,مدينة السادات,طريق مبارك,مصنع اما السادات",
    "Distance Travelled": "0.00",
    "Max Speed": "0",
    "Event Type": "Parking",
    Geofence: "",
    "": "30.556198",
  },
  {
    "Start Date": "26/12/2023 01:26:16",
    "End Date": "26/12/2023 01:41:14",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address":
      "الطريق الإقليمي, مدينة السادات, محافظة المنوفية, مصر (Egypt)",
    "To Address":
      "الطريق الإقليمي, مدينة السادات, محافظة المنوفية, مصر (Egypt)",
    "Distance Travelled": "7.12",
    "Max Speed": "44",
    "Event Type": "Moving",
    Geofence: "",
    "": "30.54082",
  },
  {
    "Start Date": "26/12/2023 01:41:14",
    "End Date": "26/12/2023 01:42:28",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address":
      "الطريق الإقليمي, مدينة السادات, محافظة المنوفية, مصر (Egypt)",
    "To Address": "مصر,المنوفية,مركز السادات,مدينة السادات,6,مصنع",
    "Distance Travelled": "0.00",
    "Max Speed": "0",
    "Event Type": "Idle",
    Geofence: "",
    "": "30.540087",
  },
  {
    "Start Date": "26/12/2023 01:42:28",
    "End Date": "26/12/2023 01:44:13",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,مدينة السادات,6,مصنع",
    "To Address": "مصر,المنوفية,مركز السادات,مدينة السادات,6,مصنع هوليوود",
    "Distance Travelled": "0.27",
    "Max Speed": "13",
    "Event Type": "Moving",
    Geofence: "",
    "": "30.54153",
  },
  {
    "Start Date": "26/12/2023 01:44:33",
    "End Date": "26/12/2023 01:54:54",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,مدينة السادات,6,مصنع هوليوود",
    "To Address": "مصر,المنوفية,مركز السادات,مدينة السادات,6,مصنع هوليوود",
    "Distance Travelled": "0.00",
    "Max Speed": "0",
    "Event Type": "Parking",
    Geofence: "",
    "": "30.54153",
  },
  {
    "Start Date": "26/12/2023 01:55:51",
    "End Date": "26/12/2023 02:07:00",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,مدينة السادات,6,مصنع يوروديب",
    "To Address": "مصر,المنوفية,مركز السادات,,,",
    "Distance Travelled": "4.27",
    "Max Speed": "35",
    "Event Type": "Moving",
    Geofence: "",
    "": "30.566688",
  },
  {
    "Start Date": "26/12/2023 02:07:00",
    "End Date": "26/12/2023 02:09:09",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,,,",
    "To Address": "مصر,المنوفية,مركز السادات,,,",
    "Distance Travelled": "0.00",
    "Max Speed": "0",
    "Event Type": "Idle",
    Geofence: "",
    "": "30.566439",
  },
  {
    "Start Date": "26/12/2023 02:09:09",
    "End Date": "26/12/2023 02:15:08",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,,,",
    "To Address": "مصر,المنوفية,مركز السادات,,,",
    "Distance Travelled": "1.00",
    "Max Speed": "18",
    "Event Type": "Moving",
    Geofence: "",
    "": "30.566631",
  },
  {
    "Start Date": "26/12/2023 02:16:01",
    "End Date": "26/12/2023 12:31:57",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,,,",
    "To Address": "مصر,المنوفية,مركز السادات,,,",
    "Distance Travelled": "0.00",
    "Max Speed": "0",
    "Event Type": "Parking",
    Geofence: "",
    "": "30.56656",
  },
  {
    "Start Date": "26/12/2023 12:31:57",
    "End Date": "26/12/2023 12:34:56",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,,,",
    "To Address": "مصر,المنوفية,مركز السادات,,,",
    "Distance Travelled": "0.00",
    "Max Speed": "0",
    "Event Type": "Idle",
    Geofence: "",
    "": "30.56605",
  },
  {
    "Start Date": "26/12/2023 12:34:56",
    "End Date": "26/12/2023 12:35:55",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,,,",
    "To Address": "مصر,المنوفية,مركز السادات,,,",
    "Distance Travelled": "0.08",
    "Max Speed": "8",
    "Event Type": "Moving",
    Geofence: "",
    "": "30.565317",
  },
  {
    "Start Date": "26/12/2023 12:36:21",
    "End Date": "26/12/2023 14:06:48",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,,,",
    "To Address": "مصر,المنوفية,مركز السادات,,,",
    "Distance Travelled": "0.00",
    "Max Speed": "0",
    "Event Type": "Parking",
    Geofence: "",
    "": "30.565317",
  },
  {
    "Start Date": "26/12/2023 14:06:48",
    "End Date": "26/12/2023 14:08:42",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,,,",
    "To Address": "مصر,المنوفية,مركز السادات,,,",
    "Distance Travelled": "0.00",
    "Max Speed": "0",
    "Event Type": "Idle",
    Geofence: "",
    "": "30.564645",
  },
  {
    "Start Date": "26/12/2023 14:08:42",
    "End Date": "26/12/2023 14:10:43",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,,,",
    "To Address": "مصر,المنوفية,مركز السادات,,,",
    "Distance Travelled": "0.40",
    "Max Speed": "19",
    "Event Type": "Moving",
    Geofence: "",
    "": "30.566769",
  },
  {
    "Start Date": "26/12/2023 14:10:43",
    "End Date": "26/12/2023 14:15:27",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,,,",
    "To Address": "مصر,المنوفية,مركز السادات,,,",
    "Distance Travelled": "0.00",
    "Max Speed": "0",
    "Event Type": "Idle",
    Geofence: "",
    "": "30.566847",
  },
  {
    "Start Date": "26/12/2023 14:15:27",
    "End Date": "26/12/2023 14:22:41",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,,,",
    "To Address": "مصر,المنوفية,مركز السادات,,,",
    "Distance Travelled": "1.70",
    "Max Speed": "26",
    "Event Type": "Moving",
    Geofence: "",
    "": "30.578563",
  },
  {
    "Start Date": "26/12/2023 14:22:41",
    "End Date": "26/12/2023 14:28:09",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,,,",
    "To Address": "مصر,المنوفية,مركز السادات,,,",
    "Distance Travelled": "0.00",
    "Max Speed": "0",
    "Event Type": "Idle",
    Geofence: "",
    "": "30.578526",
  },
  {
    "Start Date": "26/12/2023 14:28:09",
    "End Date": "26/12/2023 14:33:39",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,,,",
    "To Address": "مصر,المنوفية,مركز السادات,,,",
    "Distance Travelled": "1.17",
    "Max Speed": "19",
    "Event Type": "Moving",
    Geofence: "",
    "": "30.567861",
  },
  {
    "Start Date": "26/12/2023 14:33:39",
    "End Date": "26/12/2023 14:35:44",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,,,",
    "To Address": "مصر,المنوفية,مركز السادات,,,",
    "Distance Travelled": "0.00",
    "Max Speed": "0",
    "Event Type": "Idle",
    Geofence: "",
    "": "30.567733",
  },
  {
    "Start Date": "26/12/2023 14:35:44",
    "End Date": "26/12/2023 14:37:38",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,,,",
    "To Address": "مصر,المنوفية,مركز السادات,,,",
    "Distance Travelled": "0.23",
    "Max Speed": "8",
    "Event Type": "Moving",
    Geofence: "",
    "": "30.569667",
  },
  {
    "Start Date": "26/12/2023 14:38:01",
    "End Date": "26/12/2023 15:43:37",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,,,",
    "To Address": "مصر,المنوفية,مركز السادات,,,",
    "Distance Travelled": "0.00",
    "Max Speed": "0",
    "Event Type": "Parking",
    Geofence: "",
    "": "30.569667",
  },
  {
    "Start Date": "26/12/2023 15:44:36",
    "End Date": "26/12/2023 15:48:35",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,,,",
    "To Address": "مصر,المنوفية,مركز السادات,,,",
    "Distance Travelled": "0.50",
    "Max Speed": "19",
    "Event Type": "Moving",
    Geofence: "",
    "": "30.564656",
  },
  {
    "Start Date": "26/12/2023 15:48:35",
    "End Date": "26/12/2023 15:50:27",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,,,",
    "To Address": "مصر,المنوفية,مركز السادات,,,",
    "Distance Travelled": "0.00",
    "Max Speed": "0",
    "Event Type": "Idle",
    Geofence: "",
    "": "30.565198",
  },
  {
    "Start Date": "26/12/2023 15:50:27",
    "End Date": "26/12/2023 16:33:27",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,,,",
    "To Address": "مصر,المنوفية,مركز السادات,,,",
    "Distance Travelled": "0.00",
    "Max Speed": "0",
    "Event Type": "Parking",
    Geofence: "",
    "": "30.565198",
  },
  {
    "Start Date": "26/12/2023 16:33:53",
    "End Date": "26/12/2023 16:35:26",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,,,",
    "To Address": "مصر,المنوفية,مركز السادات,,,",
    "Distance Travelled": "0.20",
    "Max Speed": "19",
    "Event Type": "Moving",
    Geofence: "",
    "": "30.566517",
  },
  {
    "Start Date": "26/12/2023 16:35:26",
    "End Date": "26/12/2023 23:49:03",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,,,",
    "To Address": "مصر,المنوفية,مركز السادات,,,",
    "Distance Travelled": "0.00",
    "Max Speed": "0",
    "Event Type": "Parking",
    Geofence: "",
    "": "30.566517",
  },
  {
    "Start Date": "26/12/2023 23:49:03",
    "End Date": "26/12/2023 23:59:59",
    "Plate No.": "ا ط و 1867",
    Branch: "main branch",
    "Sub Branch": "",
    Group: "",
    Driver: "",
    "From Address": "مصر,المنوفية,مركز السادات,,,",
    "To Address": "مصر,المنوفية,مركز السادات,,,",
    "Distance Travelled": "0.00",
    "Max Speed": "0",
    "Event Type": "Parking",
    Geofence: "",
    "": "30.566517",
  },
];
let fromAddress = "",
  toAddress = "",
  startDate = "",
  EndDate = "",
  counter = 0,
  distance = 0,
  biggestDistance = 0,
  tempArr = [],
  backMoves = [],
  moved = false,
  backCheck = false;
let totalDistance = 0;
let totalDistances = [];

const indexOfFirstObject = moves.findIndex(
  (obj) => obj["Distance Travelled"] > 15
);

const reversemoves = [...moves].reverse();
const indexOfLastObject =
  moves.length -
  reversemoves.findIndex((obj) => obj["Distance Travelled"] > 15) -
  1;

// console.log(indexOfFirstObject, indexOfLastObject);
if (indexOfFirstObject !== -1 && indexOfLastObject !== -1) {
  // Select objects above the first
  const objectsAboveFirst = moves
    .slice(0, indexOfFirstObject)
    .map((obj) => {
      if (!tempArr.includes(obj["From Address"])) {
        tempArr.push(obj["From Address"]);
        return obj["From Address"];
      } else if (!tempArr.includes(obj["To Address"])) {
        tempArr.push(obj["To Address"]);
        return obj["To Address"];
      }
    })
    .filter(Boolean);

  tempArr.splice(0, tempArr.length);

  // Select objects below the last
  const objectsBelowLast = moves
    .slice(indexOfLastObject + 1)
    .map((obj) => {
      if (!tempArr.includes(obj["From Address"])) {
        tempArr.push(obj["From Address"]);
        return obj["From Address"];
      } else if (!tempArr.includes(obj["To Address"])) {
        tempArr.push(obj["To Address"]);
        return obj["To Address"];
      }
    })
    .filter(Boolean);

  const commonElements = objectsAboveFirst.filter((element) =>
    objectsBelowLast.includes(element)
  );
  if (commonElements.length !== 0) backCheck = true;
  console.log(commonElements); // Output: [3, 4, 5]
  // console.log("Objects above the first one:", objectsAboveFirst);
  // console.log("Objects below the last one:", objectsBelowLast);
} else {
  console.log("Error in select indexing");
}

backMoves = moves.map((move, index) => {
  // know if didn't move
  if (+move["Distance Travelled"] > biggestDistance)
    biggestDistance = +move["Distance Travelled"];
  // get first move (fromAddress & startDate)
  if (
    move["From Address"] !== move["To Address"] &&
    counter === 0 &&
    +move["Distance Travelled"] > 10
  ) {
    moved = true;
    fromAddress = move["From Address"];
    startDate = move["Start Date"].split(" ")[1];
    counter++;
  }
  // get last move (toAddress & endDate)
  if (
    move["From Address"] !== move["To Address"] &&
    +move["Distance Travelled"] > 5
  ) {
    toAddress = move["To Address"];
    EndDate = move["End Date"].split(" ")[1];
  }

  // fix bug of select last move
  // last position is changed in from address without matched with to address in above column
  if (
    index < moves.length - 1 &&
    move["To Address"] !== moves[index + 1]["From Address"]
  ) {
    toAddress = moves[index + 1]["To Address"];
    EndDate = moves[index + 1]["End Date"].split(" ")[1];
  }
  if (backCheck) {
    totalDistance += +move["Distance Travelled"];
    totalDistances.push(totalDistance);
    move["Total Distance"] = totalDistance;
    return move;
  }
});
if (backCheck) {
  const closestNumber = findClosestNumber(totalDistance / 2, totalDistances);
  // console.log("Closest number:", closestNumber);
  targetBackMoves = backMoves.filter(
    (move) => move["Total Distance"] === closestNumber
  );
  lastMove = targetBackMoves[targetBackMoves.length - 1];
  toAddress = lastMove["To Address"] + "والعودة";
}

function findClosestNumber(target, numbers) {
  return numbers.reduce((closest, current) => {
    return Math.abs(current - target) < Math.abs(closest - target)
      ? current
      : closest;
  });
}

if ((!moved || biggestDistance < 15) && !backCheck) {
  fromAddress = "";
  toAddress = "";
  startDate = "";
  EndDate = "";
  console.log("لا يكــــــــــــــــــــــــن");
} else if (fromAddress !== "") {
  console.log(fromAddress);
  console.log(toAddress);
  console.log(startDate);
  console.log(EndDate);
}
